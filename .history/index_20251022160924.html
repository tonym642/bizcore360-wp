<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BizCore360 Dashboard v5.8</title>

<!-- Bootstrap / Icons / Fonts -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{--sidebar-w:260px;}
body{font-family:'Inter',sans-serif;background:#f8f9fa;font-size:14px;}
.topbar{position:fixed;top:0;left:0;right:0;height:52px;background:#fff;border-bottom:1px solid #dee2e6;z-index:1040;display:flex;align-items:center;justify-content:space-between;padding:0 .75rem;}
.sidebar{position:fixed;top:52px;bottom:0;left:0;width:var(--sidebar-w);background:#fff;border-right:1px solid #dee2e6;overflow-y:auto;transition:left .3s;}
main{margin-left:var(--sidebar-w);padding:1rem;padding-top:4.5rem;}
@media(max-width:991px){
  .sidebar{left:-260px;}
  .sidebar.show{left:0;}
  main{margin-left:0;}
}
.sidebar .nav-link.active,.dropdown-item.active{
  color:#0d6efd!important;
  background:#eaf2ff!important;
  font-weight:600;
}
.loader-overlay{
  position:fixed;inset:0;background:rgba(255,255,255,0.6);
  display:flex;align-items:center;justify-content:center;
  z-index:2000;display:none;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="d-flex align-items-center justify-content-center vh-100">
  <div class="card shadow-sm p-4" style="max-width:360px;width:100%;">
    <h4 class="text-center mb-3 fw-bold text-primary">BizCore360</h4>
    <div class="mb-2"><label>Username</label><input id="loginUser" type="text" class="form-control"></div>
    <div class="mb-3"><label>Password</label><input id="loginPass" type="password" class="form-control"></div>
    <button id="btnLogin" class="btn btn-primary w-100">Login</button>
    <div id="loginAlert" class="text-danger small mt-2 text-center" style="display:none;">Invalid credentials</div>
  </div>
</div>

<!-- DASHBOARD PAGE -->
<div id="dashboardPage" style="display:none;">
  <nav class="topbar">
    <div class="d-flex align-items-center gap-2">
      <button id="toggleSidebar" class="btn btn-link text-dark p-0"><i class="bi bi-list fs-4"></i></button>
      <span class="fw-bold">BizCore360</span>
    </div>
    <div class="d-flex align-items-center gap-3">
      <i class="bi bi-search fs-6 text-secondary" data-page="search.html"></i>
      <i class="bi bi-sun fs-5 text-secondary" id="darkModeIcon"></i>
      <i class="bi bi-robot fs-5 text-secondary" data-page="aicoach.html"></i>
      <i class="bi bi-people fs-5 text-secondary" data-page="ai-advisory-board.html"></i>
      <div class="dropdown">
        <a href="#" class="text-dark text-decoration-none dropdown-toggle" id="userMenu" data-bs-toggle="dropdown"><i class="bi bi-person-circle fs-5"></i></a>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" data-page="profile.html" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><a class="dropdown-item" data-page="settings.html" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><a class="dropdown-item" data-page="master-specs.html" href="#"><i class="bi bi-file-earmark-text me-2"></i>Master Specs</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item text-danger" id="logout" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar">
    <ul class="list-unstyled p-2">
      <li><a href="#" class="nav-link d-flex align-items-center gap-2" data-page="dashboard.html"><i class="bi bi-speedometer2"></i>Dashboard</a></li>
      <li><a href="#" class="nav-link d-flex align-items-center gap-2" data-page="budget.html"><i class="bi bi-wallet2"></i>Budget</a></li>
      <li><a href="#" class="nav-link d-flex align-items-center gap-2" data-page="cash-flow.html"><i class="bi bi-currency-exchange"></i>Cash Flow</a></li>
      <li><a href="#" class="nav-link d-flex align-items-center gap-2" data-page="forecasts.html"><i class="bi bi-graph-up-arrow"></i>Forecasts</a></li>
    </ul>
  </aside>

  <!-- MAIN CONTENT -->
  <main id="main-content"></main>
</div>

<!-- Loading Spinner -->
<div id="loader" class="loader-overlay">
  <div class="spinner-border text-primary" role="status"></div>
</div>

<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- LOGIN SCRIPT -->
<script>
const loginPage=document.getElementById("loginPage");
const dashboardPage=document.getElementById("dashboardPage");
const btnLogin=document.getElementById("btnLogin");
const loginAlert=document.getElementById("loginAlert");

btnLogin.addEventListener("click",()=>{
  const user=document.getElementById("loginUser").value.trim();
  const pass=document.getElementById("loginPass").value.trim();
  if(user==="bizcore360"&&pass==="1234"){
    localStorage.setItem("loggedIn","true");
    loginAlert.style.display="none";
    loginPage.style.display="none";
    dashboardPage.style.display="block";
  }else{
    loginAlert.style.display="block";
  }
});
if(localStorage.getItem("loggedIn")==="true"){
  loginPage.style.display="none";
  dashboardPage.style.display="block";
}
document.getElementById("logout").addEventListener("click",()=>{
  localStorage.removeItem("loggedIn");
  dashboardPage.style.display="none";
  loginPage.style.display="flex";
});
</script>

<!-- ✅ UNIVERSAL PAGE LOADER (FINAL WORKING VERSION) -->
<script>
document.addEventListener("DOMContentLoaded",()=>{
  const content=document.querySelector("#main-content")||document.querySelector("#pageContent");
  const loader=document.getElementById("loader");
  if(!content){console.error("No main content container found.");return;}

  // Load default dashboard after login
  if(localStorage.getItem("loggedIn")==="true"){
    loadPage("dashboard.html");
  }

  // Global click handler
  document.body.addEventListener("click",async(e)=>{
    const link=e.target.closest("[data-page]");
    if(!link)return;
    e.preventDefault();
    const page=link.getAttribute("data-page");
    if(!page)return;

    document.querySelectorAll("[data-page]").forEach(el=>{
      el.classList.remove("active","text-primary");
      el.style.backgroundColor="";
    });
    link.classList.add("active","text-primary");
    link.style.backgroundColor="#eaf2ff";

    loader.style.display="flex";
    try{
      const res=await fetch(`pages/${page}`);
      if(!res.ok)throw new Error(`Failed to load ${page}`);
      const html=await res.text();
      content.innerHTML=html;

      // Execute inline scripts
      const parser=new DOMParser();
      const doc=parser.parseFromString(html,"text/html");
      doc.querySelectorAll("script").forEach(s=>{
        if(s.textContent.trim()){
          const exec=document.createElement("script");
          exec.textContent=s.textContent;
          document.body.appendChild(exec);
          document.body.removeChild(exec);
        }
      });
      console.log("✅ Loaded:",page);
    }catch(err){
      console.error("❌ Load error:",err);
      content.innerHTML=`<div class='alert alert-danger m-3'><i class='bi bi-exclamation-triangle me-2'></i> Error loading <strong>${page}</strong>. Check path.</div>`;
    }finally{
      loader.style.display="none";
    }
  });

  // Page load function (also callable from elsewhere)
  async function loadPage(page){
    loader.style.display="flex";
    try{
      const res=await fetch(`pages/${page}`);
      if(!res.ok)throw new Error(`Missing ${page}`);
      const html=await res.text();
      content.innerHTML=html;
    }catch(err){
      content.innerHTML=`<p class='text-danger m-3'>Error loading ${page}</p>`;
    }finally{
      loader.style.display="none";
    }
  }
});
</script>

</body>
</html>

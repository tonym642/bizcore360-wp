<div class="container-fluid p-4">
  <div class="card shadow-sm rounded-3">
    <div class="card-body">
      <h4 class="mb-3 fw-semibold text-primary" id="moduleTitle"></h4>

      <!-- 4-Tab Icon Menu -->
      <ul class="nav nav-tabs justify-content-start gap-2 border-0" id="moduleTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="main-tab" data-bs-toggle="tab" data-bs-target="#main" type="button" role="tab" data-bs-toggle="tooltip" title="Overview">
            <i class="bi bi-speedometer2 fs-5"></i>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" data-bs-toggle="tooltip" title="Info">
            <i class="bi bi-info-circle fs-5"></i>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="ai-tab" data-bs-toggle="tab" data-bs-target="#ai" type="button" role="tab" data-bs-toggle="tooltip" title="AI Agent">
            <i class="bi bi-robot fs-5"></i>
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tech-tab" data-bs-toggle="tab" data-bs-target="#tech" type="button" role="tab" data-bs-toggle="tooltip" title="Tech Details">
            <i class="bi bi-gear fs-5"></i>
          </button>
        </li>
      </ul>

      <!-- Tab Content -->
      <div class="tab-content mt-4" id="moduleTabsContent">

        <!-- 1️⃣ MAIN TAB: Your existing Budget Form -->
        <div class="tab-pane fade show active" id="main" role="tabpanel">
          <h5 class="fw-semibold" id="mainTabTitle"></h5>

          <form id="budgetForm" class="needs-validation" novalidate>
            <div class="row mb-3 flex-row align-items-center">
              <div class="col-5 col-md-4 d-flex align-items-center justify-content-md-end justify-content-start">
                <label for="budgetMonth" class="form-label fw-medium w-100 text-md-end text-start mb-0">Month</label>
              </div>
              <div class="col-7 col-md-8">
                <input type="month" class="form-control text-start" id="budgetMonth" required />
              </div>
            </div>

            <div class="row mb-3 flex-row align-items-center">
              <div class="col-5 col-md-4 d-flex align-items-center justify-content-md-end justify-content-start">
                <label for="budgetYear" class="form-label fw-medium w-100 text-md-end text-start mb-0">Year</label>
              </div>
              <div class="col-7 col-md-8">
                <input type="number" class="form-control text-start" id="budgetYear" placeholder="2025" min="2000" max="2100" />
              </div>
            </div>

            <div class="row mb-3 flex-row align-items-center">
              <div class="col-5 col-md-4 d-flex align-items-center justify-content-md-end justify-content-start">
                <label for="totalIncome" class="form-label fw-medium w-100 text-md-end text-start mb-0">Total Income ($)</label>
              </div>
              <div class="col-7 col-md-8">
                <input type="number" class="form-control text-start" id="totalIncome" placeholder="0.00" step="0.01" />
              </div>
            </div>

            <div class="row mb-3 flex-row align-items-center">
              <div class="col-5 col-md-4 d-flex align-items-center justify-content-md-end justify-content-start">
                <label for="totalExpenses" class="form-label fw-medium w-100 text-md-end text-start mb-0">Total Expenses ($)</label>
              </div>
              <div class="col-7 col-md-8">
                <input type="number" class="form-control text-start" id="totalExpenses" placeholder="0.00" step="0.01" />
              </div>
            </div>

            <div class="row mb-3 flex-row align-items-start">
              <div class="col-5 col-md-4 d-flex align-self-start justify-content-md-end justify-content-start">
                <label for="budgetNotes" class="form-label fw-medium w-100 text-md-end text-start mb-0">Notes</label>
              </div>
              <div class="col-7 col-md-8">
                <textarea class="form-control text-start" id="budgetNotes" rows="3" placeholder="Add budget notes..."></textarea>
              </div>
            </div>

            <div class="text-end">
              <button type="reset" class="btn btn-outline-secondary me-2">Clear</button>
              <button type="submit" class="btn btn-primary">Save Budget</button>
            </div>
          </form>

          <div id="budgetAlert" class="alert alert-success mt-3 d-none" role="alert">
            ✅ Budget saved successfully!
          </div>
        </div>

        <!-- 2️⃣ INFO TAB -->
        <div class="tab-pane fade" id="info" role="tabpanel">
          <h5 class="fw-semibold">About This Page</h5>
          <p id="infoText" class="text-secondary"></p>
        </div>

        <!-- 3️⃣ AI AGENT TAB -->
        <div class="tab-pane fade" id="ai" role="tabpanel">
          <h5 class="fw-semibold">AI Agent</h5>
          <form id="aiForm" class="mt-3">
            <div class="mb-3">
              <label class="form-label">Ask the Budget AI</label>
              <textarea class="form-control" id="aiInput" rows="3" placeholder="e.g., Suggest how to reduce my expenses"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Run with AI</button>
          </form>
          <div id="aiOutput" class="mt-3"></div>
        </div>

        <!-- 4️⃣ TECH DETAILS TAB -->
        <div class="tab-pane fade" id="tech" role="tabpanel">
          <h5 class="fw-semibold">Technical Information</h5>
          <pre class="bg-light p-3 rounded small" id="techData"></pre>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Initialize Universal Module -->
<script>
initModulePage({
  name: "budget",
  title: "Budget Planner",
  info: "This page allows you to record and analyze your income and expenses, save your monthly budget, and run AI suggestions for optimization.",
  aiEndpoint: "/api/budget/run"
});

// simple local save feedback
document.getElementById('budgetForm').addEventListener('submit', function(e){
  e.preventDefault();
  document.getElementById('budgetAlert').classList.remove('d-none');
  setTimeout(() => document.getElementById('budgetAlert').classList.add('d-none'), 3000);
});
</script>

<!-- test-version: 2025-10-22-final -->
